 テスト戦略の最終段階に到達し、包括的なユニットテストの準備が整いました。システムの複雑な相互作用を考慮し、各モックポイントを慎重に検討する必要があります。

✻ Thinking…

  これで十分な分析ができました。CLI構造、コマンドハンドラー、依存関係の分析が完了しています。

  実際にファイルを読んだ結果：
  1. workflow_cli.py: メインCLIエントリーポイント（全コマンド定義あり）
  2. plan_command_handler.py: Google Sheets起票（ProgressManager使用）
  3. create_command_handler.py: SQLiteワークフロー状態管理（WorkflowController使用）
  4. subagent_command_handler.py: SubAgent連携（複数依存関係）

  これらの情報を基に、包括的なユニットテスト計画を作成します。

●User approved Claude's plan:
  ⎿  ワークフローCLIユニットテスト作成計画

     📋 実装概要

     ワークフローシステムの全17コマンドに対するユニットテストを作成します。モック機能により実際のDB・Google Sheetsを更新せずにテストを実行できます。

     🏗️ テスト構造

     1. テストファイル構成

     tests/
     ├── workflow/
     │   ├── __init__.py
     │   ├── test_workflow_cli.py          # メインCLIテスト
     │   ├── test_plan_command_handler.py  # planコマンドテスト
     │   ├── test_create_command_handler.py # createコマンドテスト
     │   ├── test_subagent_command_handler.py # SubAgentコマンドテスト
     │   └── fixtures/
     │       ├── mock_data.py              # テストデータ
     │       └── workflow_fixtures.py     # テスト設備

     2. モック対象依存関係

     - ProgressManager: Google Sheets API呼び出し
     - WorkflowController: SQLite状態管理
     - SubAgentMonitor: プロセス監視システム
     - SubAgentLockManager: ロック管理
     - WorkspaceConfig: 設定管理
     - ファイルシステム操作: os.path, Path operations

     🧪 テスト対象コマンド

     基本コマンド (10個)

     - plan: Google Sheets起票テスト
     - create: SQLiteワークフロー作成テスト
     - status: 状態取得テスト
     - instructions: 指示取得テスト
     - step: ステップ実行テスト
     - approvals: 承認リスト表示テスト
     - process: プロセス状態確認テスト
     - sheets: Google Sheets状態確認テスト
     - template: テンプレート生成テスト
     - guide: ガイド表示テスト

     SubAgentコマンド (11個)

     - subagent-extraction: 抽出処理開始テスト
     - subagent-status: 状態確認テスト
     - subagent-wait: 完了待機テスト
     - subagent-retry: 再実行テスト
     - subagent-terminate: 終了テスト
     - subagent-cleanup: ロッククリーンアップテスト
     - subagent-locks-status: ロック状況確認テスト
     - subagent-cleanup-all: 全ロッククリーンアップテスト
     - subagent-auto-retry-check: 自動再実行条件確認テスト
     - subagent-auto-retry: 自動再実行テスト
     - subagent-auto-retry-all: 全自動再実行テスト

     🛠️ 技術仕様

     モック戦略

     - unittest.mock: Pythonの標準モックライブラリ使用
     - patch decorator: 依存関係の注入置換
     - MagicMock: 複雑なオブジェクトの模擬
     - return_value/side_effect: 戻り値とエラー条件の制御

     テストケース種類

     - 正常系: 正常な引数での期待動作確認
     - 異常系: 不正な引数でのエラーハンドリング確認
     - 境界値: 文字数制限等の境界条件確認
     - 既存データ: 重複ID等の既存データ処理確認

     🔧 実装手順

     1. テスト基盤作成: ディレクトリ構造とベースクラス
     2. 基本コマンドテスト: plan, create, status, instructions, step
     3. 管理コマンドテスト: approvals, process, sheets, template, guide
     4. SubAgentテスト: 全11のSubAgentコマンド
     5. 統合テスト: CLI全体の動作確認

     📊 成果物

     - テストカバレッジ: 全21コマンドの完全網羅
     - 実行安全性: 実際のDB・API呼び出しなし
     - CI/CD対応: 自動テスト実行対応
     - ドキュメント: テスト実行手順とメンテナンス方法
